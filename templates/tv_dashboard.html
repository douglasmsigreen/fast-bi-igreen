{# templates/tv_dashboard.html #}
<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{ title }}</title>

    {# --- Google Font (Inter) --- #}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    {# --- Font Awesome (Para ícones) --- #}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    {# --- Chart.js (Para o gráfico) --- #}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {# --- NOVO: Plugin de rótulos de dados --- #}
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    {# --- CSS Personalizado --- #}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tv_dashboard.css') }}">

</head>
<body class="tv-dashboard-body">

    <div class="tv-dashboard-header">
        {# --- CORRIGIDO: Logo como link para a página de login --- #}
        <a href="{{ url_for('auth_bp.login') }}">
            <img src="{{ url_for('static', filename='img/logo_igreen_branco.png') }}" alt="iGreen Energy Logo" class="tv-logo">
        </a>
        {# --- FIM DA CORREÇÃO --- #}
        <h1 class="tv-title">TV Conexão Green - Atualização em Tempo Real</h1>
        
        <div class="tv-clock">
            {# --- Indicador AO VIVO --- #}
            <div class="live-indicator">
                <div class="live-dot"></div>
                <span>AO VIVO</span>
            </div>
            <div id="relogio"></div>
        </div>
    </div>

    <div class="tv-dashboard-grid">

        {# Coluna da Esquerda (KPIs e Gráfico) #}
        <div class="grid-left-column">
            
            {# Card 1: Total de Ativações #}
            <div class="tv-card-small">
                <h3 class="card-title">
                    <i class="fas fa-plug" style="margin-right: 8px;"></i>
                    Ativações no Mês
                </h3>
                <div class="main-number-container">
                    <span id="ativacoes-mes" class="main-number loading-pulse">...</span>
                </div>
                <p class="sub-text">
                    Variação Mensal: <span id="ativacoes-percentual" class="percent-text loading-pulse">...</span>
                    <span class="mes-anterior-label">Mês anterior:</span>
                    <span id="ativacoes-mes-anterior" class="mes-anterior-valor loading-pulse">...</span>
                </p>
            </div>

            {# Card 2: NOVO - Total de kWh Ativados - AGORA EM SEGUNDO #}
            <div class="tv-card-small">
                <h3 class="card-title">
                    <i class="fas fa-bolt" style="margin-right: 8px;"></i>
                    Total de kWh Ativados
                </h3>
                <div class="main-number-container">
                    <span id="kwh-mes" class="main-number loading-pulse">...</span>
                </div>
                <p class="sub-text">
                    Variação Mensal: <span id="kwh-percentual" class="percent-text loading-pulse">...</span>
                    <span class="mes-anterior-label">Mês anterior:</span>
                    <span id="kwh-mes-anterior" class="mes-anterior-valor loading-pulse">...</span>
                </p>
            </div>

            {# Card 3: NOVO - Cadastros, Validados e Cancelados - AGORA EM TERCEIRO #}
            <div class="tv-card-small wide-card">
                <h3 class="card-title">
                    <i class="fas fa-users" style="margin-right: 8px;"></i>
                    Status dos Cadastros
                </h3>
                <div class="kpi-group">
                    <div class="kpi-item kpi-item-purple">
                        <span id="cadastrados-quantidade" class="kpi-number loading-pulse">...</span>
                        <span id="cadastrados-soma-consumo" class="kpi-subnumber loading-pulse">...</span>
                        <p class="kpi-label">Cadastrados</p>
                    </div>
                    <div class="kpi-item kpi-item-warning">
                        <span id="backlog-a-validar-quantidade" class="kpi-number loading-pulse">...</span>
                        <span id="backlog-a-validar-soma-consumo" class="kpi-subnumber loading-pulse">...</span>
                        <p class="kpi-label">Backlog - A Validar</p>
                    </div>
                    <div class="kpi-item kpi-item-info">
                        <span id="a-validar-quantidade" class="kpi-number loading-pulse">...</span>
                        <span id="a-validar-soma-consumo" class="kpi-subnumber loading-pulse">...</span>
                        <p class="kpi-label">Mês Atual - A Validar</p>
                    </div>
                    <div class="kpi-item">
                        <span id="validados-quantidade" class="kpi-number loading-pulse">...</span>
                        <span id="validados-soma-consumo" class="kpi-subnumber loading-pulse">...</span>
                        <p class="kpi-label">Validados</p>
                    </div>
                    <div class="kpi-item kpi-item-danger">
                        <span id="cancelados-quantidade" class="kpi-number loading-pulse">...</span>
                        <span id="cancelados-soma-consumo" class="kpi-subnumber loading-pulse">...</span>
                        <p class="kpi-label">Cancelados</p>
                    </div>
                </div>
            </div>

            {# Card 4: Gráfico de Ativações por Mês #}
            <div class="tv-card-chart">
                <h3 class="card-title">
                    <i class="fas fa-chart-line" style="margin-right: 8px;"></i>
                    Ativações por Mês (Últimos 6 Meses)
                </h3>
                <canvas id="ativacoesMensalChart"></canvas>
            </div>
        </div>

        {# Coluna da Direita (Top 5) #}
        <div class="grid-right-column">
            
            {# Card 4: Top 5 Regiões #}
            <div class="tv-card-small">
                <h3 class="card-title">
                    <i class="fas fa-globe" style="margin-right: 8px; color: #3f4cf8;"></i>
                    Top 5 Regiões
                </h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Região</th>
                            <th>Atv.</th>
                            <th>kWh Atv.</th>
                            <th>Valid.</th>
                            <th>kWh Valid.</th>
                        </tr>
                    </thead>
                    <tbody id="top-regioes-table">
                        <tr><td colspan="5" class="loading-text">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>

            {# Card 5: Top 5 Fornecedoras #}
            <div class="tv-card-small">
                <h3 class="card-title">
                    <i class="fas fa-industry" style="margin-right: 8px; color: #ab3bf6;"></i>
                    Top 5 Fornecedoras
                </h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Fornecedora</th>
                            <th>Atv.</th>
                            <th>kWh Atv.</th>
                            <th>Valid.</th>
                            <th>kWh Valid.</th>
                        </tr>
                    </thead>
                    <tbody id="top-fornecedoras-table">
                        <tr><td colspan="5" class="loading-text">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>

            {# Card 6: Top 5 Licenciados #}
            <div class="tv-card-small">
                <h3 class="card-title">
                    <i class="fas fa-star" style="margin-right: 8px; color: #F59E0B;"></i>
                    Top 5 Licenciados
                </h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Licenciado</th>
                            <th>UF</th>
                            <th>Atv.</th>
                            <th>kWh Atv.</th>
                        </tr>
                    </thead>
                    <tbody id="top-licenciados-table">
                        <tr><td colspan="4" class="loading-text">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {# Script JS para carregar os dados e atualizar a página #}
    <script src="{{ url_for('static', filename='js/tv_dashboard.js') }}"></script>

</body>
</html>